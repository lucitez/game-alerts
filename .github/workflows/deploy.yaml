name: Deploy Cloud Function
run-name: Deploying commit ${{ github.event.head_commit.message }}
on:
  push:
    branches:
      - main
      - test-deploy
jobs:
  Deploy-Cloud-Function:
    runs-on: macos-latest
    steps:
      - name: Checking out repository
        uses: actions/checkout@v4
     - id: 'auth'
        name: 'Authenticate to Google Cloud'
        uses: 'google-github-actions/auth@v2'
        with:
          credentials_json: '${{ secrets.GCP_SA_DEPLOY_KEY }}'
      - name: 'Set up Cloud SDK'
        uses: 'google-github-actions/setup-gcloud@v1'
        with:
          version: '>= 363.0.0'
      - name: 'Use gcloud CLI'
        run: 'gcloud info'
      - run: echo "Deploying cloud function"
      - run: gcloud functions deploy SendGameAlert \
          --gen2 \
          --region=us-west1 \
          --runtime=go122 \
          --entry-point=SendGameAlert \
          --trigger-topic=game-alerts
